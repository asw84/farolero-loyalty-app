# Журнал Изменений Проекта

Этот документ описывает основные функции, добавленные в проект после первоначального архитектурного рефакторинга.

## Версия 2.0: Мультиплатформенная геймификация

### 1. Внедрение Базы Данных (SQLite)

- **Цель:** Создание единого и надежного источника данных для хранения информации о пользователях, их баллах и активностях, что является фундаментом для всей системы лояльности.
- **Ключевые изменения:**
    - Добавлена зависимость `sqlite3` для работы с файловой базой данных.
    - Создан модуль `database.js`, который управляет подключением, созданием таблиц (`users`, `activity`) и предоставляет функции для работы с данными (`findOrCreateUser`, `addPoints` и др.).
    - Все ключевые сервисы (`user`, `webhook`, `admin`) были переведены на работу с новой базой данных, что обеспечило консистентность данных.

### 2. Интеграция с ВКонтакте (VK)

- **Цель:** Расширение системы лояльности для отслеживания активности и привязки пользователей из VK.
- **Ключевые изменения:**
    - **Получение событий (Callback API):** Создан эндпоинт `/api/webhooks/vk` и соответствующие сервисы для обработки событий от VK, таких как новые комментарии.
    - **Привязка аккаунта (OAuth):** Реализован полный серверный цикл авторизации через VK OAuth. Это позволяет пользователям безопасно привязывать свой VK-аккаунт к основному профилю в мини-приложении.
    - **Обновление UI:** На страницу профиля в мини-приложении добавлена кнопка "Привязать VK" с соответствующей логикой.

### 3. Интеграция с Instagram

- **Цель:** Предоставление пользователям возможности безопасно привязать свой Instagram-аккаунт для последующего начисления баллов за активность.
- **Ключевые изменения:**
    - **Привязка аккаунта (OAuth):** Реализован полный серверный цикл авторизации через Instagram OAuth. Бэкенд теперь может обменивать временный код на токен доступа и получать `instagram_user_id` и `username`.
    - **Обновление UI:** На страницу профиля добавлена кнопка "Привязать Instagram".

### 4. Исправление и Улучшение Админ-панели

- **Цель:** Обеспечение целостности данных путем перевода всей логики админки на работу с внутренней базой данных, вместо внешних сервисов.
- **Ключевые изменения:**
    - Сервис `admin.service.js` был полностью переписан для использования `database.js`.
    - Функции получения статистики (`getStats`) и ручной корректировки баллов (`adjustPoints`) теперь работают напрямую с базой данных SQLite, что гарантирует, что все изменения (автоматические и ручные) отражаются в едином источнике.

### 5. Тестовое покрытие

- Все новые функции (интеграция с VK, Instagram OAuth, работа с БД) были покрыты автоматическими тестами с использованием Jest и Supertest, что обеспечивает стабильность и надежность бэкенда.
