# üöÄ –ü–ª–∞–Ω —Ä–∞–∑–≤–∏—Ç–∏—è –ø—Ä–æ–µ–∫—Ç–∞ Farolero Loyalty App

## üìã –û–±–∑–æ—Ä —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è

**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –ø—Ä–æ–µ–∫—Ç–∞: ~85%**

### ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:
- Telegram Mini App (React + TypeScript)
- Backend API (Node.js + Express)
- AmoCRM –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (–±–∞–∑–æ–≤–∞—è)
- –°–∏—Å—Ç–µ–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ —Å –±–∞–ª–ª–∞–º–∏
- Qtickets –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- Admin –ø–∞–Ω–µ–ª—å (–±–∞–∑–æ–≤–∞—è)
- Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- **üÜï –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å QR-–∫–æ–¥–∞–º–∏**
- **üÜï RFM-–∞–Ω–∞–ª–∏–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**
- **üÜï –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –¥–∞—à–±–æ—Ä–¥**
- **üÜï –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π AmoCRM**
- **üÜï –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞–º–∏**

### ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–Ω–æ –∫–æ–¥ –≥–æ—Ç–æ–≤):
- VK/Instagram –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (–Ω—É–∂–Ω—ã —Ä–µ–∞–ª—å–Ω—ã–µ API –∫–ª—é—á–∏)
- AmoCRM –∫–∞—Å—Ç–æ–º–Ω—ã–µ –ø–æ–ª—è (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É—Ç–∏–ª–∏—Ç—É –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è)

### ‚ùå –û—Å—Ç–∞–ª–æ—Å—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å:
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≤ —Å–æ—Ü—Å–µ—Ç—è—Ö
- –°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞—Ç—É—Å–æ–≤ –∏ –∫—ç—à–±—ç–∫–∞

---

## üéØ –≠–¢–ê–ü 1: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º (1-2 –¥–Ω—è)

### 1.1 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö API –∫–ª—é—á–µ–π üîë
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô**

#### VK API:
- [ ] –ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π `VK_CLIENT_SECRET` –∏–∑ [VK Developers](https://dev.vk.com/)
- [ ] –ü–æ–ª—É—á–∏—Ç—å `VK_SERVICE_KEY` –¥–ª—è —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `.env` —Ñ–∞–π–ª
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å VK OAuth flow

#### Instagram API:
- [ ] –°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ [Meta for Developers](https://developers.facebook.com/)
- [ ] –ü–æ–ª—É—á–∏—Ç—å `INSTAGRAM_APP_ID` –∏ `INSTAGRAM_APP_SECRET`
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Redirect URI
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `.env` —Ñ–∞–π–ª

### 1.2 –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ AmoCRM –ø–æ–ª–µ–π üéØ
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —É—Ç–∏–ª–∏—Ç—É –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
cd backend && node utils/autodetect-fields.js
```

### 1.3 –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã ‚ö°
```bash
# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è Docker
docker-compose down && docker-compose up --build

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker-compose logs -f backend
```

---

## üéØ –≠–¢–ê–ü 2: –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ (3-5 –¥–Ω–µ–π)

### 2.1 Backend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:
```sql
-- –¢–∞–±–ª–∏—Ü–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
CREATE TABLE referrals (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    referrer_telegram_id TEXT NOT NULL,
    referee_telegram_id TEXT NOT NULL,
    referral_code TEXT UNIQUE NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    activated_at DATETIME,
    bonus_paid BOOLEAN DEFAULT FALSE,
    bonus_amount INTEGER DEFAULT 0
);

-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
CREATE INDEX idx_referral_code ON referrals(referral_code);
CREATE INDEX idx_referrer ON referrals(referrer_telegram_id);
```

#### API Endpoints:
- [ ] `POST /api/referral/generate` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞
- [ ] `GET /api/referral/my-code` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–≤–æ–µ–≥–æ –∫–æ–¥–∞
- [ ] `POST /api/referral/activate` - –∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ –∫–æ–¥—É
- [ ] `GET /api/referral/stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
- [ ] `GET /api/referral/qr/:code` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è QR-–∫–æ–¥–∞

#### –§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è:
```
backend/
‚îú‚îÄ‚îÄ services/referral.service.js      # –õ–æ–≥–∏–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
‚îú‚îÄ‚îÄ controllers/referral.controller.js # API endpoints
‚îú‚îÄ‚îÄ routes/referral.routes.js          # –ú–∞—Ä—à—Ä—É—Ç—ã
‚îî‚îÄ‚îÄ utils/qr-generator.js              # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è QR-–∫–æ–¥–æ–≤
```

### 2.2 Frontend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### –°—Ç—Ä–∞–Ω–∏—Ü—ã:
- [ ] `ReferralPage.tsx` - –æ—Å–Ω–æ–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
- [ ] `MyReferralsPage.tsx` - —Å–ø–∏—Å–æ–∫ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω—ã—Ö
- [ ] `ReferralStatsPage.tsx` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –Ω–∞–≥—Ä–∞–¥—ã

#### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- [ ] `QRCodeGenerator.tsx` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è QR-–∫–æ–¥–∞
- [ ] `ReferralCodeInput.tsx` - –≤–≤–æ–¥ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞
- [ ] `ReferralStats.tsx` - –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

### 2.3 –õ–æ–≥–∏–∫–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –±–∞–ª–ª–æ–≤

#### –ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —Ä–µ—Ñ–µ—Ä–∞–ª—É:
1. –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –∫–æ–¥
2. –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å –∫–æ–¥–∞
3. –°–æ–∑–¥–∞–µ—Ç—Å—è —Å–≤—è–∑—å referrer ‚Üî referee
4. –ù–∞—á–∏—Å–ª—è—é—Ç—Å—è –±–∞–ª–ª—ã —Ä–µ—Ñ–µ—Ä–µ—Ä—É (50 –±–∞–ª–ª–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
5. –ë–æ–Ω—É—Å –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (20 –±–∞–ª–ª–æ–≤)

#### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å AmoCRM:
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –ø–æ–ª–µ–π –ø—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –≤ AmoCRM
- [ ] –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–∞—á–∏—Å–ª–µ–Ω–Ω—ã—Ö –±–∞–ª–ª–æ–≤

---

## üéØ –≠–¢–ê–ü 3: RFM-–∞–Ω–∞–ª–∏–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (2-3 –¥–Ω—è)

### 3.1 –¢–µ–æ—Ä–∏—è RFM
**RFM = Recency + Frequency + Monetary**
- **R (Recency)** - –∫–æ–≥–¥–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑ –ø–æ–∫—É–ø–∞–ª
- **F (Frequency)** - –∫–∞–∫ —á–∞—Å—Ç–æ –ø–æ–∫—É–ø–∞–µ—Ç  
- **M (Monetary)** - —Å–∫–æ–ª—å–∫–æ —Ç—Ä–∞—Ç–∏—Ç –¥–µ–Ω–µ–≥

### 3.2 Database schema
```sql
-- –¢–∞–±–ª–∏—Ü–∞ –ø–æ–∫—É–ø–æ–∫ –¥–ª—è RFM
CREATE TABLE purchases (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_telegram_id TEXT NOT NULL,
    amount DECIMAL(10,2) NOT NULL,
    purchase_date DATETIME DEFAULT CURRENT_TIMESTAMP,
    source TEXT, -- 'qtickets', 'direct', etc.
    FOREIGN KEY (user_telegram_id) REFERENCES users(telegram_id)
);

-- –¢–∞–±–ª–∏—Ü–∞ RFM —Å–µ–≥–º–µ–Ω—Ç–æ–≤
CREATE TABLE rfm_segments (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_telegram_id TEXT UNIQUE NOT NULL,
    recency_score INTEGER, -- 1-5
    frequency_score INTEGER, -- 1-5  
    monetary_score INTEGER, -- 1-5
    segment_name TEXT, -- 'Champions', 'Loyal Customers', etc.
    calculated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_telegram_id) REFERENCES users(telegram_id)
);
```

### 3.3 RFM —Å–µ–≥–º–µ–Ω—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

#### –ü—Ä–µ–º–∏—É–º —Å–µ–≥–º–µ–Ω—Ç—ã:
- **Champions** (R:5, F:5, M:5) - –ª—É—á—à–∏–µ –∫–ª–∏–µ–Ω—Ç—ã
- **Loyal Customers** (R:5, F:4, M:4) - –ª–æ—è–ª—å–Ω—ã–µ –ø–æ–∫—É–ø–∞—Ç–µ–ª–∏
- **Potential Loyalists** (R:5, F:3, M:3) - –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –ª–æ—è–ª—å–Ω—ã–µ

#### –°—Ä–µ–¥–Ω–∏–µ —Å–µ–≥–º–µ–Ω—Ç—ã:
- **New Customers** (R:5, F:1, M:1) - –Ω–æ–≤—ã–µ –∫–ª–∏–µ–Ω—Ç—ã
- **Promising** (R:4, F:1, M:1) - –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–Ω—ã–µ
- **Need Attention** (R:3, F:3, M:3) - —Ç—Ä–µ–±—É—é—Ç –≤–Ω–∏–º–∞–Ω–∏—è

#### –ü—Ä–æ–±–ª–µ–º–Ω—ã–µ —Å–µ–≥–º–µ–Ω—Ç—ã:
- **About to Sleep** (R:2, F:2, M:2) - –∑–∞—Å—ã–ø–∞—é—â–∏–µ
- **At Risk** (R:2, F:4, M:4) - –ø–æ–¥ —É–≥—Ä–æ–∑–æ–π –æ—Ç—Ç–æ–∫–∞
- **Cannot Lose Them** (R:1, F:5, M:5) - –Ω–µ–ª—å–∑—è –ø–æ—Ç–µ—Ä—è—Ç—å
- **Hibernating** (R:1, F:1, M:1) - —Å–ø—è—â–∏–µ

### 3.4 Implementation

#### –§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è:
```
backend/
‚îú‚îÄ‚îÄ services/rfm.service.js           # RFM —Ä–∞—Å—á–µ—Ç—ã
‚îú‚îÄ‚îÄ controllers/analytics.controller.js # –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ API
‚îú‚îÄ‚îÄ routes/analytics.routes.js        # –ú–∞—Ä—à—Ä—É—Ç—ã –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
‚îî‚îÄ‚îÄ utils/rfm-calculator.js           # –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä RFM
```

#### API Endpoints:
- [ ] `GET /api/analytics/rfm/calculate` - –ø–µ—Ä–µ—Å—á–µ—Ç RFM –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- [ ] `GET /api/analytics/rfm/segments` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–µ–≥–º–µ–Ω—Ç–æ–≤
- [ ] `GET /api/analytics/rfm/user/:id` - RFM –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [ ] `GET /api/analytics/dashboard` - –æ–±—â–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

#### Frontend:
- [ ] `AnalyticsPage.tsx` - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- [ ] `RFMChart.tsx` - –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è RFM
- [ ] `SegmentsList.tsx` - —Å–ø–∏—Å–æ–∫ —Å–µ–≥–º–µ–Ω—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

---

## üéØ –≠–¢–ê–ü 4: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≤ —Å–æ—Ü—Å–µ—Ç—è—Ö (2-3 –¥–Ω—è)

### 4.1 VK –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

#### –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ:
- [ ] –õ–∞–π–∫–∏ –ø–æ—Å—Ç–æ–≤ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞
- [ ] –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –ø–æ—Å—Ç–∞–º
- [ ] –†–µ–ø–æ—Å—Ç—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- [ ] –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ

#### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:
```javascript
// backend/services/vk-activity.service.js
class VKActivityService {
    async checkUserActivity(vkUserId, postId) {
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∞–π–∫–æ–≤ —á–µ—Ä–µ–∑ VK API
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–ø–æ—Å—Ç–æ–≤
    }
    
    async awardPointsForActivity(telegramId, activityType, points) {
        // –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–∞–ª–ª–æ–≤ –∑–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
    }
}
```

### 4.2 Instagram –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

#### –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ:
- [ ] –õ–∞–π–∫–∏ –ø–æ—Å—Ç–æ–≤
- [ ] –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
- [ ] –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∞–∫–∫–∞—É–Ω—Ç
- [ ] Stories interactions

#### Limitations:
Instagram API –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º –æ –ª–∞–π–∫–∞—Ö/–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:
- –ó–∞–ø—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Instagram Basic Display API
- –†—É—á–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

### 4.3 –°–∏—Å—Ç–µ–º–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –±–∞–ª–ª–æ–≤

#### –¢–∞—Ä–∏—Ñ—ã:
```javascript
const SOCIAL_POINTS = {
    VK: {
        LIKE: 1,
        COMMENT: 3,
        REPOST: 5,
        SUBSCRIBE: 10
    },
    INSTAGRAM: {
        LIKE: 1,
        COMMENT: 3,
        FOLLOW: 10,
        STORY_VIEW: 2
    }
};
```

---

## üéØ –≠–¢–ê–ü 5: –°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞—Ç—É—Å–æ–≤ –∏ –∫—ç—à–±—ç–∫–∞ (1-2 –¥–Ω—è)

### 5.1 –£—Ä–æ–≤–Ω–∏ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏

#### –°—Ç–∞—Ç—É—Å—ã –ø–æ –±–∞–ª–ª–∞–º:
```javascript
const LOYALTY_LEVELS = [
    { name: '–ù–æ–≤–∏—á–æ–∫',   minPoints: 0,     cashbackPercent: 1,  color: '#gray' },
    { name: '–î—Ä—É–≥',      minPoints: 100,   cashbackPercent: 3,  color: '#blue' },
    { name: 'VIP',       minPoints: 500,   cashbackPercent: 5,  color: '#gold' },
    { name: '–ü–ª–∞—Ç–∏–Ω–∞',   minPoints: 1000,  cashbackPercent: 7,  color: '#platinum' },
    { name: '–ê–ª–º–∞–∑',     minPoints: 2500,  cashbackPercent: 10, color: '#diamond' }
];
```

### 5.2 –ö—ç—à–±—ç–∫ —á–µ—Ä–µ–∑ Qtickets

#### –õ–æ–≥–∏–∫–∞:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–æ–ø–∏—Ç –±–∞–ª–ª—ã
2. –ü—Ä–∏ –ø–æ–∫—É–ø–∫–µ –±–∏–ª–µ—Ç–æ–≤ –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–∞—Ç–∏—Ç—å –±–∞–ª–ª—ã
3. 1 –±–∞–ª–ª = 1 —Ä—É–±–ª—å —Å–∫–∏–¥–∫–∏
4. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–∏–¥–∫–∞ - 50% –æ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –±–∏–ª–µ—Ç–∞

#### Integration:
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `qticketsService.js` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∫—ç—à–±—ç–∫–∞
- [ ] –î–æ–±–∞–≤–∏—Ç—å API endpoint `POST /api/tickets/purchase-with-cashback`
- [ ] –°–æ–∑–¥–∞—Ç—å UI –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ä–∞–∑–º–µ—Ä–∞ –∫—ç—à–±—ç–∫–∞

---

## üìä –ü–õ–ê–ù –†–ï–ê–õ–ò–ó–ê–¶–ò–ò –ü–û –í–†–ï–ú–ï–ù–ò

### –ù–µ–¥–µ–ª—è 1 (5 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π):
- **–î–µ–Ω—å 1-2**: –≠–¢–ê–ü 1 - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º
- **–î–µ–Ω—å 3-5**: –≠–¢–ê–ü 2 - –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ (backend)

### –ù–µ–¥–µ–ª—è 2 (5 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π):
- **–î–µ–Ω—å 1-2**: –≠–¢–ê–ü 2 - –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ (frontend)
- **–î–µ–Ω—å 3-5**: –≠–¢–ê–ü 3 - RFM-–∞–Ω–∞–ª–∏–∑

### –ù–µ–¥–µ–ª—è 3 (5 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π):
- **–î–µ–Ω—å 1-3**: –≠–¢–ê–ü 4 - –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–æ—Ü—Å–µ—Ç–µ–π
- **–î–µ–Ω—å 4-5**: –≠–¢–ê–ü 5 - –°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞—Ç—É—Å–æ–≤

### –ò—Ç–æ–≥–æ: ~15 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π (3 –Ω–µ–¥–µ–ª–∏)

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã:
```bash
# Unit —Ç–µ—Å—Ç—ã –¥–ª—è RFM
npm test -- rfm.service.test.js

# Integration —Ç–µ—Å—Ç—ã –¥–ª—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã  
npm test -- referral.integration.test.js

# E2E —Ç–µ—Å—Ç—ã –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ flow
npm run test:e2e
```

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ VK/Instagram OAuth
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ QR-–∫–æ–¥–æ–≤
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è RFM —Ä–∞—Å—á–µ—Ç–æ–≤
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—ç—à–±—ç–∫ —Å–∏—Å—Ç–µ–º—ã

---

## üöÄ –†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–ï

### Production checklist:
- [ ] –í—Å–µ API –∫–ª—é—á–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] Database –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã  
- [ ] Docker volumes –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] Backup —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å –±–∞–ª–ª–∞–º–∏
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ API calls –∫ –≤–Ω–µ—à–Ω–∏–º —Å–µ—Ä–≤–∏—Å–∞–º
- [ ] –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã
- [ ] –ú–µ—Ç—Ä–∏–∫–∏ RFM —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏

---

**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É: 100% —á–µ—Ä–µ–∑ 3 –Ω–µ–¥–µ–ª–∏** üéâ
