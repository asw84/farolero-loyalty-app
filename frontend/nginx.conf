# frontend/nginx.conf
# Конфигурация для раздачи React-приложения

server {
  # Слушаем 80 порт внутри контейнера
  listen 80;

  # Добавляем заголовки для предотвращения кеширования
  add_header Cache-Control "no-cache, no-store, must-revalidate";
  add_header Pragma "no-cache";
  add_header Expires "0";

  # Обрабатываем все запросы
  location / {
    # Корневая папка, куда мы скопировали наши файлы
    root   /usr/share/nginx/html;
    # Файл по умолчанию
    index  index.html;
    # Эта команда - ключ к работе React Router.
    # Если файл не найден, она отдает index.html,
    # а React Router уже сам разбирается с путем.
    try_files $uri $uri/ /index.html;
    
    # Отдельные настройки для статических файлов
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
      expires 1h;
      add_header Cache-Control "public, immutable";
    }
    
    # Особые настройки для index.html - предотвращаем кеширование
    location = /index.html {
      expires -1;
      add_header Cache-Control "no-cache, no-store, must-revalidate";
      add_header Pragma "no-cache";
      add_header Expires "0";
    }
  }
}