#!/bin/bash

echo "üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Ñ–∞–π–ª–æ–≤ –≤ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –±—ç–∫–µ–Ω–¥–∞"
echo "================================================="

# –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
echo "üõë –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã..."
docker-compose down

# –°–æ–±–∏—Ä–∞–µ–º –±—ç–∫–µ–Ω–¥ —Å –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
echo "üèóÔ∏è –°–æ–±–∏—Ä–∞–µ–º –±—ç–∫–µ–Ω–¥..."
docker-compose build backend

# –ó–∞–ø—É—Å–∫–∞–µ–º –±—ç–∫–µ–Ω–¥ –≤ —Ä–µ–∂–∏–º–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–∞–π–ª–æ–≤
echo "üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–∞–π–ª–æ–≤..."
docker run --rm -it --name farolero-debug \
  -v $(pwd)/backend:/app \
  farolero-loyalty-app-backend \
  sh -c "echo '=== –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ /app ===' && ls -la /app && \
          echo '' && \
          echo '=== –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ /app/services ===' && ls -la /app/services && \
          echo '' && \
          echo '=== –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞ vk.oauth.service.js ===' && \
          if [ -f /app/services/vk.oauth.service.js ]; then echo '‚úÖ –§–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç'; else echo '‚ùå –§–∞–π–ª –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç'; fi && \
          echo '' && \
          echo '=== –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ vk.oauth.service.js (–ø–µ—Ä–≤—ã–µ 5 —Å—Ç—Ä–æ–∫) ===' && \
          head -n 5 /app/services/vk.oauth.service.js"

echo ""
echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"