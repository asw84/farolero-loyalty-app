# Инструкция по использованию скрипта скачивания кода с ветки final

## Описание

Скрипт `download-final-branch.sh` предназначен для скачивания последней версии кода с ветки `final` из GitHub на сервер. Скрипт сохраняет все критически важные файлы (токены, настройки) перед обновлением и восстанавливает их после.

## Что делает скрипт

1. Сохраняет критически важные файлы во временную директорию:
   - `backend/tokens.json`
   - `backend/.env`
   - `frontend/.env`
   - `backend/amocrm/amocrm.json`
   - `backend/app/tokens/` (вся директория)

2. Скачивает последние изменения из ветки `final`:
   ```bash
   git fetch origin
   git reset --hard origin/final
   ```

3. Восстанавливает сохраненные файлы

4. Очищает временные файлы

## Подготовка скрипта к использованию

1. Скопируйте файл `download-final-branch.sh` на сервер в директорию проекта `/var/www/farolero-loyalty-app/`

2. Сделайте скрипт исполняемым:
   ```bash
   chmod +x download-final-branch.sh
   ```

## Использование скрипта

1. Перейдите в директорию проекта:
   ```bash
   cd /var/www/farolero-loyalty-app
   ```

2. Запустите скрипт:
   ```bash
   ./download-final-branch.sh
   ```

## После скачивания кода

После успешного скачивания кода вы можете:

1. **Проверить текущую ветку:**
   ```bash
   git branch
   ```

2. **Посмотреть последние коммиты:**
   ```bash
   git log --oneline -10
   ```

3. **Запустить полный деплой (если необходимо):**
   ```bash
   ./deploy-final-branch.sh
   ```

## Важные замечания

- Скрипт только скачивает код с GitHub, но не перезапускает контейнеры Docker
- Все токены и настройки сохраняются и восстанавливаются автоматически
- Для применения изменений в работе приложения необходимо запустить полный деплой
- Скрипт безопасен для использования, так как сохраняет все критически важные файлы

## Отличие от deploy-final-branch.sh

| download-final-branch.sh | deploy-final-branch.sh |
|--------------------------|------------------------|
| Только скачивает код | Полный цикл деплоя |
| Не останавливает контейнеры | Останавливает и перезапускает контейнеры |
| Не пересобирает Docker образы | Полная пересборка образов |
| Быстрое выполнение | Длительное выполнение |
| Без простоев приложения | С простоями приложения |

## Рекомендации по использованию

- Используйте `download-final-branch.sh` когда нужно быстро получить последние изменения кода без перезапуска приложения
- Используйте `deploy-final-branch.sh` когда нужно применить изменения и перезапустить приложение с новыми настройками

## Troubleshooting

### Если скрипт не запускается:
1. Проверьте права доступа:
   ```bash
   ls -la download-final-branch.sh
   ```
2. Убедитесь, что скрипт находится в нужной директории

### Если возникают ошибки с Git:
1. Проверьте статус Git:
   ```bash
   git status
   ```
2. Убедитесь, что у вас есть доступ к репозиторию:
   ```bash
   git remote -v
   ```

### Если файлы не восстанавливаются:
1. Проверьте наличие бэкапа:
   ```bash
   ls -la /tmp/farolero-backup/
   ```
2. Убедитесь, что все необходимые файлы были сохранены перед обновлением