# üß™ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é VK –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

## üéØ –¶–µ–ª—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã VK –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –Ω—É–∂–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:
1. **VK ID OAuth** - –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–∑–∞–¥–∞—á–∞ 1.1)
2. **VK API** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (–∑–∞–¥–∞—á–∞ 3.2)

## üìã –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è `.env`:
```env
# VK ID OAuth (–¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
VK_CLIENT_ID=54020028
VK_CLIENT_SECRET=–≤–∞—à_—Ä–µ–∞–ª—å–Ω—ã–π_–∑–∞—â–∏—â—ë–Ω–Ω—ã–π_–∫–ª—é—á
VK_SERVICE_KEY=–≤–∞—à_—Å–µ—Ä–≤–∏—Å–Ω—ã–π_–∫–ª—é—á

# VK API (–¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏)
VK_ACCESS_TOKEN=—Ç–æ–∫–µ–Ω_—Å_–ø—Ä–∞–≤–∞–º–∏_wall_groups
VK_GROUP_ID=123456789
VK_GROUP_TOKEN=–≥—Ä—É–ø–ø–æ–≤–æ–π_—Ç–æ–∫–µ–Ω

# VK Bot API (–¥–ª—è —Å–æ–±—ã—Ç–∏–π)
VK_CONFIRMATION_TOKEN=—Å—Ç—Ä–æ–∫–∞_–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
VK_SECRET_KEY=—Å–µ–∫—Ä–µ—Ç–Ω—ã–π_–∫–ª—é—á
```

## üî¨ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ —ç—Ç–∞–ø–∞–º

### –≠—Ç–∞–ø 1: –ë–∞–∑–æ–≤–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
```bash
cd backend
node test-vk-integration.js
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
‚úÖ VK_CLIENT_ID –Ω–∞—Å—Ç—Ä–æ–µ–Ω: 54020028
‚úÖ VK_CLIENT_SECRET –Ω–∞—Å—Ç—Ä–æ–µ–Ω  
‚úÖ VK_REDIRECT_URI –Ω–∞—Å—Ç—Ä–æ–µ–Ω
‚úÖ JWT_SECRET –Ω–∞—Å—Ç—Ä–æ–µ–Ω
‚úÖ VK OAuth API –¥–æ—Å—Ç—É–ø–µ–Ω
‚úÖ VK API –¥–æ—Å—Ç—É–ø–µ–Ω
```

### –≠—Ç–∞–ø 2: –¢–µ—Å—Ç VK API –º–µ—Ç–æ–¥–æ–≤
```bash
cd backend
node test-vk-social-tracking.js
```

**–ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è:**
- `isMember()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –≥—Ä—É–ø–ø—É
- `hasLikedPost()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–∞–π–∫–∞ –ø–æ—Å—Ç–∞
- `hasCommentedPost()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
- `hasReposted()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–ø–æ—Å—Ç–∞

### –≠—Ç–∞–ø 3: –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
cd backend
node test-vk-social-tracking.js --interactive
```

–í–≤–µ–¥–∏—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
- VK ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- ID –ø–æ—Å—Ç–∞ –∏–∑ –≤–∞—à–µ–π VK –≥—Ä—É–ø–ø—ã

### –≠—Ç–∞–ø 4: –¢–µ—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ VK ID
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
npm start

# –í –±—Ä–∞—É–∑–µ—Ä–µ –æ—Ç–∫—Ä—ã—Ç—å:
http://localhost:3001/auth/vk/login?tg_user_id=test_123
```

### –≠—Ç–∞–ø 5: –¢–µ—Å—Ç –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏
curl -X POST http://localhost:3001/api/vk/verify-activity \
  -H "Content-Type: application/json" \
  -d '{"action":"subscribe"}'

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∞–π–∫–∞
curl -X POST http://localhost:3001/api/vk/verify-activity \
  -H "Content-Type: application/json" \
  -d '{
    "action":"like",
    "target":{
      "ownerId":"-123456789",
      "postId":"1"
    }
  }'
```

## üîß –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: "VK API error: Invalid access token"
**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å VK_ACCESS_TOKEN –≤ .env
2. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ —Ç–æ–∫–µ–Ω –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ `wall`, `groups`
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ç–æ–∫–µ–Ω –Ω–µ –∏—Å—Ç–µ–∫

### –ü—Ä–æ–±–ª–µ–º–∞: "User not found" –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
**–†–µ—à–µ–Ω–∏–µ:**
1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π VK ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ VK_GROUP_ID –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π

### –ü—Ä–æ–±–ª–µ–º–∞: "Post not found"
**–†–µ—à–µ–Ω–∏–µ:**
1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π ID –ø–æ—Å—Ç–∞ –∏–∑ –≤–∞—à–µ–π VK –≥—Ä—É–ø–ø—ã
2. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –ø–æ—Å—Ç –ø—É–±–ª–∏—á–Ω—ã–π
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç: ownerId –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º –¥–ª—è –≥—Ä—É–ø–ø

## üìä –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### ‚úÖ VK ID OAuth (–∑–∞–¥–∞—á–∞ 1.1):
- [ ] –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ AmoCRM
- [ ] VK ID —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –∫–∞—Å—Ç–æ–º–Ω–æ–µ –ø–æ–ª–µ

### ‚úÖ VK API (–∑–∞–¥–∞—á–∞ 3.2):
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –≥—Ä—É–ø–ø—É —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∞–π–∫–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç  
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–ø–æ—Å—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ë–∞–ª–ª—ã –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è –∑–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
1. –ó–∞–¥–∞—á–∞ 1.1 ‚úÖ **COMPLETED**
2. –ó–∞–¥–∞—á–∞ 3.2 üöÄ **–ì–û–¢–û–í–ê –ö –í–´–ü–û–õ–ù–ï–ù–ò–Æ**
3. –ú–æ–∂–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫ –∑–∞–¥–∞—á–∞–º 2.1, 2.2 (—Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞, —Å—Ç–∞—Ç—É—Å—ã)
