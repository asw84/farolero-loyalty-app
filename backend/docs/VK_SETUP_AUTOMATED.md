# üîµ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ VK –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

## üéØ –ë—ã—Å—Ç—Ä–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (5 –º–∏–Ω—É—Ç)

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ VK –∫–ª—é—á–µ–π

#### –®–∞–≥ 1: –ó–∞—Ö–æ–¥–∏–º –≤ VK Developers
```bash
# –û—Ç–∫—Ä—ã–≤–∞–µ–º –±—Ä–∞—É–∑–µ—Ä
https://dev.vk.com/
```

#### –®–∞–≥ 2: –°–æ–∑–¥–∞–µ–º/–≤—ã–±–∏—Ä–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- **–¢–∏–ø**: –í–µ–±-—Å–∞–π—Ç  
- **–î–æ–º–µ–Ω**: `api.5425685-au70735.twc1.net`
- **Redirect URI**: `https://api.5425685-au70735.twc1.net/api/oauth/vk/callback`

#### –®–∞–≥ 3: –ö–æ–ø–∏—Ä—É–µ–º –∫–ª—é—á–∏
```env
VK_CLIENT_ID=54020028                    # ‚úÖ –£–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
VK_CLIENT_SECRET=–†–ï–ê–õ–¨–ù–´–ô_–ó–ê–©–ò–©–Å–ù–ù–´–ô_–ö–õ–Æ–ß  # ‚ùå –ù—É–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å
VK_SERVICE_KEY=–†–ï–ê–õ–¨–ù–´–ô_–°–ï–†–í–ò–°–ù–´–ô_–ö–õ–Æ–ß     # ‚ùå –ù—É–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å
```

---

## üõ†Ô∏è –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

### –ó–∞–ø—É—Å–∫ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
```bash
cd backend
node test-vk-integration.js
```

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
```
‚úÖ VK_CLIENT_ID –Ω–∞—Å—Ç—Ä–æ–µ–Ω: 54020028
‚úÖ VK_CLIENT_SECRET –Ω–∞—Å—Ç—Ä–æ–µ–Ω  
‚úÖ VK_REDIRECT_URI –Ω–∞—Å—Ç—Ä–æ–µ–Ω
‚úÖ JWT_SECRET –Ω–∞—Å—Ç—Ä–æ–µ–Ω
‚úÖ VK API –¥–æ—Å—Ç—É–ø–µ–Ω

üéØ VK –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å: 100%
```

---

## üîß –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### –°–æ–∑–¥–∞–Ω–∏–µ .env —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏
```bash
# –ó–∞–ø—É—Å–∫ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
node scripts/setup-vk-keys.js
```

–°–∫—Ä–∏–ø—Ç –∑–∞–ø—Ä–æ—Å–∏—Ç:
1. VK_CLIENT_SECRET –∏–∑ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏  
2. VK_SERVICE_KEY (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
3. VK_GROUP_ID (–¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏)
4. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç JWT_SECRET –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

---

## üìä –£—Ä–æ–≤–Ω–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ VK

### –£—Ä–æ–≤–µ–Ω—å 1: –ë–∞–∑–æ–≤–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (90%)
```env
VK_CLIENT_ID=54020028
VK_CLIENT_SECRET=–≤–∞—à_—Ä–µ–∞–ª—å–Ω—ã–π_–∫–ª—é—á  # ‚ö†Ô∏è –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û
VK_REDIRECT_URI=https://api.5425685-au70735.twc1.net/api/oauth/vk/callback
JWT_SECRET=auto_generated_secret
```

**–ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç**: OAuth –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, –ø—Ä–∏–≤—è–∑–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–æ–≤

### –£—Ä–æ–≤–µ–Ω—å 2: VK ID API (95%)
```env
# + –£—Ä–æ–≤–µ–Ω—å 1
VK_SERVICE_KEY=–≤–∞—à_—Å–µ—Ä–≤–∏—Å–Ω—ã–π_–∫–ª—é—á  # –î–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
```

**–ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç**: + –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –£—Ä–æ–≤–µ–Ω—å 3: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (100%)
```env
# + –£—Ä–æ–≤–µ–Ω—å 2  
VK_GROUP_ID=123456789              # ID –≤–∞—à–µ–π –≥—Ä—É–ø–ø—ã
VK_GROUP_TOKEN=–≥—Ä—É–ø–ø–æ–≤–æ–π_—Ç–æ–∫–µ–Ω     # –¢–æ–∫–µ–Ω —Å –ø—Ä–∞–≤–∞–º–∏
```

**–ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç**: + –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ª–∞–π–∫–æ–≤, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤, —Ä–µ–ø–æ—Å—Ç–æ–≤

---

## üöÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
```bash
curl "https://api.5425685-au70735.twc1.net/api/oauth/vk/login?tg_user_id=test_123"
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
```
https://api.5425685-au70735.twc1.net/auth/vk-test
```

### Health check
```bash
curl "https://api.5425685-au70735.twc1.net/health"
```

---

## ‚ùå –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏

### –û—à–∏–±–∫–∞: "VK_CLIENT_SECRET —Å–æ–¥–µ—Ä–∂–∏—Ç placeholder"
```bash
# –ü—Ä–æ–±–ª–µ–º–∞: VK_CLIENT_SECRET=–í–ê–®_–ó–ê–©–ò–©–Å–ù–ù–´–ô_–ö–õ–Æ–ß_–ò–ó_VK

# –†–µ—à–µ–Ω–∏–µ:
1. –ó–∞–π—Ç–∏ –≤ https://dev.vk.com/
2. –í—ã–±—Ä–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
3. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å "–ó–∞—â–∏—â—ë–Ω–Ω—ã–π –∫–ª—é—á" 
4. –ó–∞–º–µ–Ω–∏—Ç—å –≤ backend/.env
```

### –û—à–∏–±–∫–∞: "OAuth redirect_uri mismatch"
```bash
# –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π redirect_uri –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö VK

# –†–µ—à–µ–Ω–∏–µ:
1. –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö VK –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
2. –î–æ–±–∞–≤–∏—Ç—å: https://api.5425685-au70735.twc1.net/api/oauth/vk/callback
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
```

### –û—à–∏–±–∫–∞: "JWT_SECRET too short"
```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ —Å–µ–∫—Ä–µ—Ç–∞:
node -e "console.log('JWT_SECRET=' + require('crypto').randomBytes(64).toString('hex'))"
```

---

## üìã –ß–µ–∫-–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

- [ ] VK_CLIENT_SECRET –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π –∫–ª—é—á
- [ ] VK_SERVICE_KEY –Ω–∞—Å—Ç—Ä–æ–µ–Ω (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)  
- [ ] JWT_SECRET —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω (32+ —Å–∏–º–≤–æ–ª–æ–≤)
- [ ] VK_REDIRECT_URI –¥–æ–±–∞–≤–ª–µ–Ω –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- [ ] `node test-vk-integration.js` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 100%
- [ ] –¢–µ—Å—Ç–æ–≤–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### ‚ùå –ù–ï –∫–æ–º–º–∏—Ç–∏—Ç—å –≤ Git
```bash
# –≠—Ç–∏ —Ñ–∞–π–ª—ã –≤ .gitignore:
backend/.env
backend/tokens.json
```

### ‚úÖ –î–ª—è production
```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è Docker:
docker-compose.yml:
  environment:
    - VK_CLIENT_SECRET=${VK_CLIENT_SECRET}
    - VK_SERVICE_KEY=${VK_SERVICE_KEY}
```

### üîÑ –†–æ—Ç–∞—Ü–∏—è –∫–ª—é—á–µ–π
```bash
# –ö–∞–∂–¥—ã–µ 90 –¥–Ω–µ–π –æ–±–Ω–æ–≤–ª—è—Ç—å:
1. VK_CLIENT_SECRET –≤ VK Developers
2. VK_SERVICE_KEY
3. JWT_SECRET (–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π)
```

---

*–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ VK –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ Farolero Loyalty App*
